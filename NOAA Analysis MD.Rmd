---
title: "Effects of Major Storm Events on U.S. Population Health and Economy"
author: "Ashly Yashchin"
date: "6/6/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Synopsis
Placeholder Text.

##Loading and Processing the Raw Data
This data has been provided by the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. It can be found [here](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2). The supporting data documentation can be found [here](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf).

###Reading in the Data
```{r}
dataUrl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
if(!file.exists("./data")){dir.create("./data")}
data <- download.file(dataUrl,destfile="./data/NOAA_storm_data.zip")
data <- read.csv("./data/NOAA_storm_data.zip",header=TRUE,sep=",")
dim(data)
head(data)
```

###Processing the Raw Data
First, let's identify the questions we are trying to solve:

1. Across the United States, which types of events (as indicated in the 𝙴𝚅𝚃𝚈𝙿𝙴 variable) are most harmful with respect to population health?

2. Across the United States, which types of events have the greatest economic consequences?

Great, now that we know what we're trying to answer, we can process the raw data and prep it for analysis. Let's create two new data subsets, one for each question. We will call them "healthdata" and "economicdata" respectively. We will use the dplyr package to assist.

```{r}
library(dplyr)
healthdata <- data %>% select(EVTYPE,STATE__,STATE,FATALITIES,INJURIES,REFNUM)
```
Let's check for missing values:
```{r} sum(is.na(healthdata$FATALITIES))```

There are no missing values. This data set is ready for manipulation and analysis.
Now, let's create our second subset.

```{r}
economicdata <- data %>% select(EVTYPE,STATE__,STATE,PROPDMG,PROPDMGEXP,CROPDMG,CROPDMGEXP,REFNUM)
```

Let's check for missing values:
```{r} sum(is.na(economicdata$PROPDMG))+sum(is.na(economicdata$CROPDMG))```

There are no missing values. This data set is ready for manipulation and analysis.

##Results
###Analysis of storm events on U.S. health outcomes.
Using our "healthdata" subset, we will conduct an analysis to answer Question 1. Let's start by taking a quick look at our dataset. 

```{r} 
dim(healthdata)
head(healthdata)
```
Let's add a column called "TOTAL" which sums the number of Fatalities and Injuries and arrange in descending order. 

```{r}
healthdata <- healthdata %>% mutate(TOTAL=FATALITIES+INJURIES) %>% select(EVTYPE:INJURIES,TOTAL,REFNUM) %>% arrange(desc(TOTAL))
```
Let's take a look at this new data. 
```{r} healthdata[1:20,]```

Looks like Tornados are pretty dangerous. Let's get a sum by event and save it to a new variable. Since we're looking for the events with the greatest impact on health, let's remove those that have no impact.
```{r}
eventhealth <- healthdata %>% group_by(EVTYPE) %>% summarize(sum(TOTAL)) %>% rename(OUTCOMES =`sum(TOTAL)`) %>% arrange(desc(OUTCOMES)) %>% filter(OUTCOMES>0)
summary(eventhealth)
eventhhealth[1:20,]
```
We can see that tornados are by far the most detrimental to human health. Before we plot, let's further refine this subset to only include data for events with total negative health outcomes in the 3rd Quantile or above.

```{r}
worstevents <- eventhealth %>% filter(OUTCOMES > quantile(OUTCOMES,0.75))